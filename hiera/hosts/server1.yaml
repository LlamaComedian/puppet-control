---
classes:
  - profiles::packages
  - profiles::eap_dc

wildfly::version: '7.1'
wildfly::install_source: 'http://192.168.35.60/jboss-eap-7.1.0.Alpha.tar.gz'
wildfly::properties:
  'jboss.bind.address.management': '192.168.42.49'
  'jboss.bind.address': '192.168.42.49'
wildfly::mgmt_user:
  'username': 'slave'
  'password': 'passw0rd!'
wildfly::dc_server_groups:
  'backend_cluster_server_group':
    config:
      profile: 'full-ha'
      socket-binding-group: 'full-ha-sockets'
  'frontend_lb_server_group':
    config:
      profile: 'ha'
      socket-binding-group: 'ha-sockets'
wildfly::servers:
   '/host=server2/server-config=slave1_server2':
     content:
       'group':  'backend_cluster_server_group'
       'socket-binding-port-offset': 10
   '/host=server3/server-config=slave1_server3':
     content:
       'group':  'frontend_lb_server_group'
       'socket-binding-port-offset': 10

wildfly::mod_cluster_config:
  '/profile=full-ha/subsystem=modcluster/mod-cluster-config=configuration':
    'recursive': true
    content:
        'advertise-security-key': secret

wildfly::undertow_config:
  '/profile=ha/subsystem=undertow/configuration=filter/mod-cluster=modcluster':
    'recursive': true
    content:
      'management-socket-binding': http
      'advertise-socket-binding': modcluster
      'security-key': secret

wildfly::default_undertow:
  '/profile=ha/subsystem=undertow/server=default-server/host=default-host/filter-ref=modcluster':
    'ensure': present

wildfly::deployment:
  'cluster-demo.war':
    'source': 'http://192.168.35.60/cluster-demo.war'
    'server_group': 'backend_cluster_server_group'

packages:
  - java-1.8.0-openjdk-1.8.0.121-0.b13.el7_3